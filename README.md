# PureRate

PureRate is a lightweight, natively compiled macOS Menu Bar application that effortlessly synchronizes your system's hardware audio sample rate to match the exact lossless/hi-res lossless format of the currently playing track in Apple Music.

<img width="257" height="316" alt="SCR-20260220-nqxe" src="https://github.com/user-attachments/assets/868e0318-2079-45f8-802a-1408d95e852a" />
<img width="253" height="346" alt="SCR-20260220-nrah" src="https://github.com/user-attachments/assets/344aa2c3-e75f-426f-ad06-cbe644b50336" />


Apple Music currently does not automatically switch your macOS audio device's sample rate, requiring tedious manual intervention via the Audio MIDI Setup utility to ensure a bit-perfect output. PureRate runs completely silently in the background and resolves this automatically!

Enjoy a true bit-perfect music listening experience.

## Features
- **Automatic Audio Format Matching:** Automatically detects sample rate changes (e.g. 44.1kHz, 96kHz, 192kHz) through native unified logs and immediately instructs CoreAudio to match them.
- **Custom App Icon & Glassmorphism UI:** Features a high-quality brand icon and a modern SwiftUI interface that blends natively with macOS.
- **Selectable Target Hardware:** A sleek drop-down menu lets you explicitly assign which DAC/Audio Device gets synchronized, or default to whatever is currently active.
- **Zero Distractions:** PureRate lives solely in your macOS status bar alongside your other utilities, cleanly hiding an optional icon.
- **Launch at Login:** Seamless toggle via the `SMAppService` API ensures PureRate is ready every time your Mac turns on.
- **Low Footprint:** Built completely with native Swift (SwiftUI, OSLog, Combine), circumventing bloated third-party wrappers or persistent dependencies.

## Installation
The easiest way to get PureRate is to download the compiled `.dmg` from the **Releases** tab.

1. Download `PureRate.dmg`
2. Open the disk image and drag `PureRate.app` into your `Applications` folder.
3. Open `PureRate` from your Launchpad.

### Permissions Notice
As PureRate deeply queries Apple Music's runtime execution via the `OSLogStore` interface, when first launched, macOS may prompt you to provide necessary accessibility or automation permissions. 

## Compiling From Source
If you wish to compile the application directly from source on your machine, a build script is provided so you do not need Xcode natively installed:

```bash
git clone https://github.com/uzzano-info/PureRate.git
cd PureRate
chmod +x build.sh create_dmg.sh
./build.sh
./create_dmg.sh
```

## How It Works
AppleScript inherently lacks an exposed variable for the bitrate or bit-depth of the current track in Apple Music. PureRate bypasses this limitation by leveraging the `OSLog` framework, intelligently parsing the verbose real-time logging artifacts (like `audioCapabilities:`) internally generated by Apple Music core frameworks, mirroring the approach of other successful open-source implementations.

## Acknowledgements
Inspiration and log-parsing detection concepts derived from the original [LosslessSwitcher](https://github.com/vincentneo/LosslessSwitcher).
