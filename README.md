# PureRate

PureRate is a lightweight, natively compiled macOS Menu Bar application that effortlessly synchronizes your system's hardware audio sample rate to match the exact lossless/hi-res lossless format of the currently playing track in Apple Music.

<img width="257" height="316" alt="SCR-20260220-nqxe" src="https://github.com/user-attachments/assets/868e0318-2079-45f8-802a-1408d95e852a" />



Apple Music currently does not automatically switch your macOS audio device's sample rate, requiring tedious manual intervention via the Audio MIDI Setup utility to ensure a bit-perfect output. PureRate runs completely silently in the background and resolves this automatically!

Enjoy a true bit-perfect music listening experience.

## Features

- **Automatic Audio Format Matching:** Automatically detects sample rate changes (e.g. 44.1kHz, 96kHz, 192kHz) through native unified logs and immediately instructs CoreAudio to match them.
- **Glassmorphism UI:** A modern, polished SwiftUI popover with gradient accents, info chips, and a live-monitoring indicator — all blending natively with macOS.
- **Live Status Display:** The prominent sample-rate readout color-codes by quality tier (Lossless / Hi-Res / Ultra Hi-Res) and shows bit depth alongside the active device.
- **Rate-Change History:** An expandable timeline records every switch with timestamps, so you can verify PureRate is working correctly.
- **Selectable Target Hardware:** A sleek drop-down menu lets you explicitly assign which DAC/Audio Device gets synchronized, or default to whatever is currently active. The supported sample rates of the selected device are displayed below.
- **Desktop Notifications:** Optional toast notifications inform you of every sample-rate switch, including the target device name.
- **Zero Distractions:** PureRate lives solely in your macOS status bar alongside your other utilities, cleanly hiding from the Dock.
- **Launch at Login:** Seamless toggle via the `SMAppService` API ensures PureRate is ready every time your Mac turns on.
- **Low Footprint:** Built completely with native Swift (SwiftUI, OSLog, Combine, CoreAudio), circumventing bloated third-party wrappers or persistent dependencies.
- **Robust Log Parsing:** Five distinct parsing patterns — including FLAC/AAC decoder formats and outputSettings — maximize detection reliability across Apple Music's internal frameworks.

## Project Structure
The PureRate project is now split into two separate repositories:
- **PureRate**: This repository (macOS App source code and builds).
- **PureRate-web**: The landing page source code.

## Installation

The easiest way to get PureRate is to download the compiled `.dmg` from the **Releases** tab.

1. Download `PureRate.dmg`
2. Open the disk image and drag `PureRate.app` into your `Applications` folder.
3. Open `PureRate` from your Launchpad.

### Permissions Notice

As PureRate deeply queries Apple Music's runtime execution via the `OSLogStore` interface, when first launched, macOS may prompt you to provide necessary accessibility or automation permissions.

## Compiling From Source

If you wish to compile the application directly from source on your machine, a build script is provided so you do not need Xcode natively installed:

```bash
git clone https://github.com/uzzano-info/PureRate.git
cd PureRate
chmod +x build.sh create_dmg.sh
./build.sh
./create_dmg.sh
```

> **Note:** The build script auto-detects your macOS version and architecture (Apple Silicon / Intel). Requires Swift 5.9+ toolchain.

## How It Works

AppleScript inherently lacks an exposed variable for the bitrate or bit-depth of the current track in Apple Music. PureRate bypasses this limitation by leveraging the `OSLog` framework, intelligently parsing verbose real-time logging artifacts (like `audioCapabilities:`, `AudioQueue`, ALAC/FLAC decoder formats) internally generated by Apple Music core frameworks, mirroring the approach of other successful open-source implementations.

The monitor polls the unified system log every 2 seconds, matching entries from Apple Music's CoreMedia and CoreAudio subsystems. When a new sample rate is detected, PureRate immediately writes the matching nominal rate to the target audio device via the CoreAudio HAL.

## Support & Share

### Support the Developer ☕️

If PureRate has improved your listening experience, consider supporting its continued development. Your support helps keep the app free, open-source, and updated for the latest macOS versions!

[![Buy Me A Coffee](https://img.shields.io/badge/Buy%20Me%20A%20Coffee-Donate-yellow.svg?style=for-the-badge&logoChart=buy-me-a-coffee)](https://www.buymeachoffee.com/purerate)

### Share the Love

Help others discover bit-perfect audio on macOS:

- [Share on X (Twitter)](https://twitter.com/intent/tweet?text=Check%20out%20PureRate%20-%20The%20automatic%20sample%20rate%20switcher%20for%20Apple%20Music%20on%20macOS!%20https://github.com/uzzano-info/PureRate)
- [Post on Reddit](https://www.reddit.com/submit?url=https://github.com/uzzano-info/PureRate&title=PureRate:%20Automatic%20Sample%20Rate%20Switching%20for%20Apple%20Music%20on%20macOS)

## Acknowledgements

Inspiration and log-parsing detection concepts derived from the original [LosslessSwitcher](https://github.com/vincentneo/LosslessSwitcher).
